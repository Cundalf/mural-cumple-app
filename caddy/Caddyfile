{
    email acundari95@gmail.com
    admin off
    persist_config off
    auto_https on
}

dominio.editar.com {
    # Opción A: Certificado interno (actual)
    tls internal
    
    # Opción B: Certificado de Cloudflare Origin (más seguro)
    # tls /path/to/cloudflare-origin.crt /path/to/cloudflare-origin.key
    
    # Reverse proxy a la aplicación Next.js
    reverse_proxy mural-cumple-app:3000 {
        # Headers específicos para Cloudflare
        header_up X-Real-IP {header.CF-Connecting-IP}
        header_up X-Forwarded-For {header.CF-Connecting-IP}
        header_up X-Forwarded-Proto {scheme}
        header_up Host {host}
        
        # Headers adicionales de Cloudflare
        header_up CF-RAY {header.CF-RAY}
        header_up CF-IPCountry {header.CF-IPCountry}
        header_up CF-Visitor {header.CF-Visitor}
        
        # Timeouts para archivos grandes
        transport http {
            read_timeout 300s
            write_timeout 300s
        }
    }
    
    # Headers de seguridad (Cloudflare también puede manejar algunos)
    header {
        # Estos headers pueden estar duplicados con Cloudflare
        # Cloudflare los puede sobrescribir según tu configuración
        X-Content-Type-Options nosniff
        X-Frame-Options SAMEORIGIN
        Referrer-Policy strict-origin-when-cross-origin
        
        # Remover headers del servidor
        -Server
        -X-Powered-By
    }
    
    # Cache para assets estáticos
    @static {
        path /_next/static/* /favicon.ico /robots.txt /sitemap.xml
    }
    header @static {
        Cache-Control "public, max-age=31536000, immutable"
    }
    
    # Logs estructurados
    log {
        output file /var/log/caddy/cumple.log {
            roll_size 100MB
            roll_keep 5
            roll_keep_for 24h
        }
        format json {
            time_format "2006-01-02T15:04:05.000Z07:00"
        }
        level INFO
    }
}